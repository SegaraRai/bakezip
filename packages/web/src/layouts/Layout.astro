---
import "../global.css";
import {
  createI18n,
  type Locale,
  LOCALES,
  getLocalizedPath,
} from "../lib/i18n";
import ThemeSelector from "../components/ThemeSelector.svelte";
import LanguageSelector from "../components/LanguageSelector.svelte";
import LanguageSuggestion from "../components/LanguageSuggestion.svelte";

interface Props {
  locale: Locale;
  rootClass?: any;
  bodyClass?: any;
  mainClass?: any;
  title?: string;
  noShare?: boolean;
  noTranslate?: boolean;
}

const {
  locale,
  title = "BakeZip",
  noShare = false,
  noTranslate = false,
} = Astro.props;
const m = createI18n(locale);

const socialImage = new URL(`/social-${locale}.png`, Astro.url);
const description = m.seo_page_description();

const alternateLinks = LOCALES.map((l) => ({
  href: new URL(getLocalizedPath(Astro.url.pathname, l.code), Astro.url),
  hreflang: l.code,
})).filter((link) => link.hreflang !== locale);
---

<!doctype html>
<html lang={locale} class="bg-base-300" class:list={Astro.props.rootClass}>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content={description} />
    <meta property="og:title" content={title} />
    <meta property="og:type" content="website" />
    <meta property="og:url" content={Astro.url} />
    <meta property="og:image" content={socialImage} />
    <meta property="og:description" content={description} />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:image" content={socialImage} />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="canonical" href={Astro.url} />
    {
      alternateLinks.map((link) => (
        <link rel="alternate" hreflang={link.hreflang} href={link.href} />
      ))
    }
    <title>{title}</title>
    <script is:inline>
      (() => {
        let theme = "light";
        try {
          theme = localStorage.getItem("theme");
          if (!theme || theme === "system") {
            theme = window.matchMedia("(prefers-color-scheme: dark)").matches
              ? "dark"
              : "light";
          }
          theme = { light: "winter", dark: "night" }[theme] ?? theme;
        } catch {}
        document.documentElement.dataset.theme = theme;
      })();
    </script>
  </head>
  <body class:list={Astro.props.bodyClass}>
    <a
      href="#main-content"
      class="not-focus:sr-only focus:absolute focus:top-4 focus:left-4 focus:z-100 btn btn-primary btn-xl"
      >{m.skip_to_main_content()}</a
    >
    <header
      class="fixed top-0 right-0 px-6 py-4 flex gap-2 justify-end z-50 not-lg:w-full bg-base-300/75 backdrop-blur-sm lg:rounded-bl-md"
    >
      {
        !noShare && (
          <span class="h-10 grid place-items-center">
            <a
              title={m.share_on_x()}
              href={`https://x.com/intent/tweet?text=${encodeURIComponent(m.share_text({ url: Astro.url }))}`}
              target="_blank"
              rel="noopener noreferrer"
              class="btn btn-sm btn-ghost gap-2"
            >
              <span
                class="icon-[mdi--share-variant] text-lg"
                aria-hidden="true"
              />
              <span class="max-sm:sr-only">{m.share_on_x()}</span>
            </a>
          </span>
        )
      }
      {
        !noTranslate && (
          <LanguageSelector
            client:idle
            currentLocale={locale}
            pathname={Astro.url.pathname}
          />
        )
      }
      <ThemeSelector client:idle locale={locale} />
    </header>
    {
      !noTranslate && (
        <LanguageSuggestion
          client:idle
          currentLocale={locale}
          pathname={Astro.url.pathname}
        />
      )
    }
    <main id="main-content" class:list={Astro.props.mainClass ?? "contents"}>
      <!-- Top Padding For Fixed Header -->
      <div class="w-full h-18 lg:hidden"></div>
      <slot />
      <!-- Bottom Padding For Language Suggestion Toast -->
      <div class="w-full h-18"></div>
    </main>
  </body>
</html>
